(()=>{"use strict";var e=function(e=[],t=null){this.tasks=JSON.parse(JSON.stringify(e)),this.taskStatus=null==t?new Array(e.length).fill(0):JSON.parse(JSON.stringify(t))};e.prototype.addTask=function(e){this.tasks.push(e),this.taskStatus.push(0)},e.prototype.completeTask=function(e){this.taskStatus[e]=1},e.prototype.removeTask=function(e){this.taskStatus.splice(e,1),this.tasks.splice(e,1)},e.prototype.show=function(){for(let e=0;e<this.tasks.length;e++)console.log(this.taskStatus[e]+" "+this.tasks[e])};var t=function(e,t,s,n,i=!1,r=1){this.title=e||"no title",this.description=t||"no description",this.dueDate=s||JSON.stringify(new Date).slice(1,11),this.priority=r,this.checkList=n,this.isComplete=i},s=function(e,t=[]){this.name=e,this.toDoLists=t};s.prototype.addToProject=function(e){this.toDoLists.push(e)},s.prototype.removeFromProject=function(e){this.toDoLists.splice(e,1)};var n=function(n="anonymous"){this.name=n,this.projects=[new s("default",[new t("Getting started","have fun",JSON.stringify(new Date).slice(1,11),new e(["item 1","item 2"])),new t("Again getting started","have fun again",JSON.stringify(new Date).slice(1,11),new e(["item 3","item 4"]))]),new s("default2",[new t("Getting started2","have fun2",JSON.stringify(new Date).slice(1,11),new e(["item 12","item 22"])),new t("Again getting started2","have fun again2",JSON.stringify(new Date).slice(1,11),new e(["item 32","item 42"]))])]};n.prototype.createNewProject=function(e){tempProj=new s(e),this.projects.push(tempProj)},n.prototype.removeProject=function(e){this.projects.splice(e,1)};var i,r=i={pushUpdate:function(){localStorage.setItem("user",JSON.stringify(this.user))},user:"",setUpUser:function(){if(null==localStorage.getItem("user"))i.user=new n;else{var r=JSON.parse(localStorage.user);Object.setPrototypeOf(r,Object.create(n.prototype)),r.projects.forEach((n=>{n.toDoLists.forEach((s=>{Object.setPrototypeOf(s,Object.create(t.prototype)),Object.setPrototypeOf(s.checkList,Object.create(e.prototype))})),Object.setPrototypeOf(n,Object.create(s.prototype))})),i.user=r}i.pushUpdate()}},o=function(e,t=null){var s=document.createElement("div");return s.className=e,null!=t&&(s.innerHTML=t),s},a=function(e,t,s=""){var n=document.createElement("input");return n.className=e,n.maxLength=t,n.placeholder=s,n},d=function(e,t=null){var s=o("checklistinputitem"),n=o("tick2"),i=a("detail2",100,"add task");return null!=t&&(i.value=t),s.appendChild(n),s.appendChild(i),e.appendChild(s),e},c=function(){var e,t=o("detailedTaskItem"),s=o("plus","+>"),n=a("titleInput",20,"Title"),i=function(e,t,s=""){var n=document.createElement("textarea");return n.className=e,n.maxLength=t,n.placeholder=s,n}("descriptionInput",200,"short description"),r=("duedateInput",(e=document.createElement("input")).className="duedateInput",e.type="date",e.min=JSON.stringify(new Date).slice(1,11),e),c=o("checklistInput");c=d(c);var l=o("saveTask","&#8629;");return t.appendChild(s),t.appendChild(n),t.appendChild(i),t.appendChild(r),t.appendChild(c),t.appendChild(l),s.onclick=e=>{d(e.srcElement.parentNode.childNodes[4])},t},l=function(s){var n={};return n.projectNo=s,n.markTaskAsDone=function(){var e=document.getElementById(this.parentNode.id).childNodes[0],t=JSON.parse(this.parentNode.id);0==r.user.projects[t[0]].toDoLists[t[1]].isComplete?(e.innerHTML="&#10003;",r.user.projects[t[0]].toDoLists[t[1]].isComplete=!0):(e.innerHTML="&#9634;",r.user.projects[t[0]].toDoLists[t[1]].isComplete=!1),r.pushUpdate()},n.markChecklistItem=function(){var e=document.getElementById(this.id).childNodes[0],t=JSON.parse(this.id);0==r.user.projects[t[0]].toDoLists[t[1]].checkList.taskStatus[t[2]]?(e.innerHTML="&#10003;",r.user.projects[t[0]].toDoLists[t[1]].checkList.taskStatus[t[2]]=!0):(e.innerHTML="&#9634;",r.user.projects[t[0]].toDoLists[t[1]].checkList.taskStatus[t[2]]=!1),r.pushUpdate()},n.expandTask=function(s){n.renderTasks(s[0]);var i,a,l,p,u,h,m,f,k,N=document.getElementById(JSON.stringify(s)),v=(i=r.user.projects[s[0]].toDoLists[s[1]],a=1==i.isComplete?"&#10003;":"&#9634;",l=o("tick",a),p=o("title",i.title),u=o("description",i.description),h=o("duedate",i.dueDate.slice(0,10)),m=function(e){var t=o("checklist");for(let r=0;r<e.tasks.length;r++){var s=o("tick");s.innerHTML=0==e.taskStatus[r]?"&#9634;":"&#10003;";var n=o("detail");n.innerHTML=e.tasks[r];var i=o("checklistitem");i.appendChild(s),i.appendChild(n),t.appendChild(i)}return t}(i.checkList),f=o("detailedTaskItem"),k=o("editButton","edit"),f.appendChild(l),f.appendChild(p),f.appendChild(u),f.appendChild(h),f.appendChild(m),f.appendChild(k),f);v.id=N.id,v.childNodes[0].onclick=n.markTaskAsDone,v.lastElementChild.onclick=i=>{var o=JSON.parse(i.srcElement.parentNode.id),a=c(),l=r.user.projects[o[0]].toDoLists[o[1]];a.childNodes[1].value=l.title,a.childNodes[2].value=l.description,a.childNodes[3].value=l.dueDate,a.childNodes[4].firstChild.remove();for(let e=0;e<l.checkList.tasks.length;e++){const t=l.checkList.tasks[e];d(a.childNodes[4],t)}var p=document.getElementById("taskList");a.childNodes[5].onclick=function(i){!function(i){var o=[];i[4].childNodes.forEach((e=>{var t=e.childNodes[1].value;""!=t&&o.push(t)}));var a=new t(i[1].value,i[2].value,i[3].value,new e(o));r.user.projects[s[0]].toDoLists.splice(s[1],1),r.user.projects[s[0]].toDoLists.push(a),n.renderTasks(s[0]),r.pushUpdate()}(i.srcElement.parentNode.childNodes)},p.replaceChild(a,document.getElementById(JSON.stringify(s))),document.getElementsByClassName("titleInput")[0].focus()};var g=0;v.childNodes[4].childNodes.forEach((e=>{e.id=JSON.stringify([s[0],s[1],g++]),e.onclick=n.markChecklistItem})),N.parentNode.replaceChild(v,N)},n.reindexTaskElemId=function(){for(var e=document.getElementById("taskList").firstElementChild,t=0;null!=e;)"plus"!=e.firstChild.firstChild.className&&(e.id=JSON.stringify([n.projectNo,t++])),e=e.nextElementSibling},n.deleteThisTask=function(e){var t=JSON.parse(this.parentNode.id);document.getElementById(this.parentNode.id).remove(),r.user.projects[t[0]].toDoLists.splice(t[1],1),n.reindexTaskElemId(),r.pushUpdate()},n.renderTaskElement=function(e){document.getElementById("taskList").appendChild(e)},n.renderTasks=function(e=n.projectNo){document.getElementById("taskList").innerHTML="";var t=r.user.projects[e],s=0;if(null!=t){var i=function(){n.expandTask(JSON.parse(this.parentNode.id))};t.toDoLists.forEach((t=>{var r,a,d,c,l,p,u,h,m,f,k=(r=t.isComplete,a=t.title,d=t.description,c=t.dueDate.slice(0,10),l=o("tick",1==r?"&#10003;":"&#9634;"),p=o("title",a),u=o("description",d),h=o("duedate",c),m=o("delete","x"),(f=o("taskItem")).appendChild(l),f.appendChild(p),f.appendChild(u),f.appendChild(h),f.appendChild(m),f);k.childNodes[0].onclick=n.markTaskAsDone;for(let e=1;e<4;e++)k.childNodes[e].onclick=i;k.childNodes[4].onclick=n.deleteThisTask,k.id=JSON.stringify([e,s++]),n.renderTaskElement(k)}))}},n},p=function(){var n,i,d;r.setUpUser(),(d=document.getElementById("username")).innerHTML=r.user.name,d.onclick=function(){var e=document.getElementById("username"),t=function(){var e=a("uname",20,"enter name"),t=o("ok","&#8629;"),s=o("username");return s.appendChild(e),s.appendChild(t),s}();t.id="username",t.childNodes[1].onclick=()=>{var e=t.childNodes[0].value;r.user.name=e||"anonymous",r.pushUpdate(),location.reload()},e.parentElement.replaceChild(t,e)},(n=0,i={},i.projectNo=n,i.myTaskRenderer=l(i.projectNo),i.projects=r.user.projects,i.highlight=e=>{var t=document.getElementsByClassName("name");for(let s=0;s<t.length;s++)t[s].style.borderColor=s==e?"rgb(255, 216, 100)":"rgb(255, 216, 100,0)"},i.openProject=e=>{var t=JSON.parse(e.srcElement.parentNode.id);i.highlight(t[0]),i.renderProjectList(t[0])},i.deleteProject=function(){var e=JSON.parse(this.parentNode.id);r.user.projects.splice([e[0]],1),r.pushUpdate(),p()},i.renderProjectCreator=function(){document.getElementById("projButton").onclick=()=>{var e,t,n,d=document.getElementById("list"),c=(e=a("projInput",20),t=o("projSave","&#8629;"),(n=o("projectItem")).appendChild(e),n.appendChild(t),n);if(c.childNodes[1].onclick=function(e){var t=e.srcElement.parentNode.childNodes[0].value,n=new s(t||"new project");r.user.projects.push(n),i.renderProjectList(r.user.projects.length-1),r.pushUpdate()},0==d.childElementCount)d.appendChild(c);else{var l=document.getElementsByClassName("projectItem");"projInput"!=l[0].childNodes[0].className&&d.insertBefore(c,l[0])}document.getElementsByClassName("projInput")[0].focus()}},i.renderTaskCreator=function(s=i.projectNo){document.getElementById("button").onclick=function(n){var o=document.getElementById("taskList"),a=c();if(a.childNodes[5].onclick=function(n){var o=n.srcElement.parentNode.childNodes;console.log(n.srcElement.parentNode),function(n){var o=[];n[4].childNodes.forEach((e=>{var t=e.childNodes[1].value;""!=t&&o.push(t)}));var a=new t(n[1].value,n[2].value,n[3].value,new e(o));r.user.projects[s].toDoLists.push(a),i.myTaskRenderer.renderTasks(),r.pushUpdate()}(o)},0==o.childElementCount)o.appendChild(a);else{var d=JSON.parse(o.lastElementChild.id);i.myTaskRenderer.renderTasks(d[0]);var l=o.firstElementChild;"tick"==l.childNodes[0].className&&o.insertBefore(a,l)}document.getElementsByClassName("titleInput")[0].focus()}},i.renderProjectList=function(e=i.projectNo){document.getElementById("list").innerHTML="";var t=0;i.projects.forEach((e=>{var s=function(e){var t=o("name",e),s=o("del",e);s.innerHTML="x",t.innerHTML=e;var n=o("projectItem");return n.appendChild(t),n.appendChild(s),n}(e.name);s.id=JSON.stringify([t++]),document.getElementById("list").appendChild(s),s.childNodes[0].onclick=i.openProject,s.childNodes[1].onclick=i.deleteProject})),i.highlight(e),i.myTaskRenderer.renderTasks(e),i.renderProjectCreator(),i.renderTaskCreator()},i).renderProjectList()};p()})();